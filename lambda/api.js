!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=require("axios")},function(e,t,n){function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}n(2).config();const{getClient:o}=n(3),{db:s}=n(5),i=n(0).default,c=n(7),u=n(8),a=n(9),l=c();l.use(u()),l.use(c.urlencoded({extended:!0})),l.use(c.json());const p=i.create({baseURL:"https://firebasedynamiclinks.googleapis.com/v1/",timeout:1e3});p.interceptors.request.use((function(e){return r({},e,{url:`${e.url}?key=${process.env.FIREBASE_API_KEY}`})}));const f=c.Router();f.get("/links",(e,t)=>{s.collection("dynamic_links").get().then(e=>{let n=[];e.forEach(e=>n.push(e.data())),t.json(n)})}),f.get("/links/:linkId",(e,t)=>{o().then(e=>{t.json({token:!0})}).catch(e=>{t.status(400).json({token:!1})})}),f.delete("/links/:linkId",(e,t)=>{}),f.post("/links",(e,t)=>{p.post("shortLinks",{dynamicLinkInfo:{domainUriPrefix:process.env.DYNAMIC_LINK_PREFIX,link:e.body.url}}).then(n=>{s.collection("dynamic_links").add({url:e.body.url,shortLink:n.data.shortLink,createdAd:new Date}).then(e=>{console.log("successfully saved link",e),t.json(n.data)})}).catch(e=>{t.status(400).json(e.response.data)})}),l.use(process.env.API_BASE_PATH,f),e.exports.handler=a(l)},function(e,t){e.exports=require("dotenv")},function(e,t,n){const{google:r}=n(4),o=n(0).default,s=JSON.parse(process.env.GOOGLE_SERVICE_ACCOUNT),i=new r.auth.JWT(s.client_email,null,s.private_key,["https://www.googleapis.com/auth/firebase"]);let c;const u=()=>new Promise((e,t)=>{if(c)return e(c);i.authorize((function(n,r){n?t(`Error making request to generate access token: ${n}`):null===r.access_token?t("Provided service account does not have permission to generate access tokens"):(c=r.access_token,e(c))}))});e.exports={getAccessToken:u,getClient:()=>u().then(e=>new Promise(t=>{t(o.create({headers:{Authorization:`Bearer ${e}`}}))}))}},function(e,t){e.exports=require("googleapis")},function(e,t,n){const r=n(6),o=JSON.parse(process.env.GOOGLE_SERVICE_ACCOUNT);r.apps.length||r.initializeApp({credential:r.credential.cert(o)}),e.exports={db:r.firestore()}},function(e,t){e.exports=require("firebase-admin")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("serverless-http")}]));